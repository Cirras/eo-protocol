<protocol>
    <enum name="InitReply" type="byte">
        <comment>Reply code sent with INIT_INIT packet</comment>
        <value name="OutOfDate">1</value>
        <value name="Ok">2</value>
        <value name="Banned">
          <comment>The official client won't display a message until the connection from the server is closed</comment>
          3
        </value>
        <value name="WarpMap">4</value>
        <value name="FileEmf">5</value>
        <value name="FileEif">6</value>
        <value name="FileEnf">7</value>
        <value name="FileEsf">8</value>
        <value name="PlayersList">9</value>
        <value name="MapMutation">10</value>
        <value name="PlayersListFriends">11</value>
        <value name="FileEcf">12</value>
    </enum>

    <enum name="InitBanType" type="byte">
        <comment>
            Ban type sent with INIT_INIT packet.
            The official client treats a value &gt;= 2 as Permanent. Otherwise, it's Temporary.
        </comment>
        <value name="Temporary">1</value>
        <value name="Permanent">2</value>
    </enum>

    <enum name="CharacterIcon" type="char">
        <comment>Icon displayed in paperdolls, books, and the online list</comment>
        <value name="Player">1</value>
        <value name="Gm">4</value>
        <value name="Hgm">5</value>
        <value name="Party">6</value>
        <value name="GmParty">9</value>
        <value name="HgmParty">10</value>
    </enum>

    <enum name="AvatarChangeType" type="char">
        <comment>How a player's appearance is changing</comment>
        <value name="Equipment">1</value>
        <value name="Hair">2</value>
        <value name="HairColor">3</value>
    </enum>

    <enum name="TalkReply" type="short">
        <comment>Reply code sent with TALK_REPLY packet</comment>
        <value name="NotFound">1</value>
    </enum>

    <enum name="SitState" type="char">
        <comment>Indicates how a player is sitting (or not sitting)</comment>
        <value name="Stand">0</value>
        <value name="Chair">1</value>
        <value name="Floor">2</value>
    </enum>

    <enum name="MapEffect" type="char">
        <comment>An effect that occurs for all players on a map</comment>
        <value name="Quake">1</value>
    </enum>

    <enum name="GuildReply" type="short">
        <comment>Reply code sent with GUILD_REPLY packet</comment>
        <value name="Busy">1</value>
        <value name="NotApproved">2</value>
        <value name="AlreadyMember">3</value>
        <value name="NoCandidates">4</value>
        <value name="Exists">5</value>
        <value name="CreateBegin">6</value>
        <value name="CreateAddConfirm">7</value>
        <value name="CreateAdd">8</value>
        <value name="RecruiterOffline">9</value>
        <value name="RecruiterNotHere">10</value>
        <value name="RecruiterWrongGuild">11</value>
        <value name="NotRecruiter">12</value>
        <value name="JoinRequest">13</value>
        <value name="NotPresent">14</value>
        <value name="AccountLow">15</value>
        <value name="Accepted">16</value>
        <value name="NotFound">17</value>
        <value name="Updated">18</value>
        <value name="RanksUpdated">19</value>
        <value name="RemoveLeader">20</value>
        <value name="RemoveNotMember">21</value>
        <value name="Removed">22</value>
        <value name="RankingLeader">23</value>
        <value name="RankingNotMember">24</value>
    </enum>

    <enum name="InnUnsubscribeReply" type="char">
        <comment>
            Reply code sent with CITIZEN_REMOVE packet.
            Indicates the result of trying to give up citizenship to a town.
        </comment>
        <value name="NotCitizen">0</value>
        <value name="Unsubscribed">1</value>
    </enum>

    <enum name="CharacterReply" type="short">
        <comment>Reply code sent with CHARACTER_REPLY packet</comment>
        <value name="Exists">1</value>
        <value name="Full">
            <comment>
                Only sent in reply to Character_Create packets.
                Displays the same message as CharacterReply.Full3 in the official client.
            </comment>
            2
        </value>
        <value name="Full3">
            <comment>
                Only sent in reply to Character_Request packets.
                Displays the same message as CharacterReply.Full in the official client.
            </comment>
            3
        </value>
        <value name="NotApproved">4</value>
        <value name="Ok">5</value>
        <value name="Deleted">6</value>
    </enum>

    <enum name="SkillMasterReply" type="short">
        <comment>
            Reply code sent with STATSKILL_REPLY packet.
            Indicates why an action was unsuccessful.
        </comment>
        <value name="RemoveItems">1</value>
        <value name="WrongClass">2</value>
    </enum>

    <enum name="AccountReply" type="short">
        <comment>Reply code sent with ACCOUNT_REPLY packet</comment>
        <value name="Exists">1</value>
        <value name="NotApproved">2</value>
        <value name="Created">3</value>
        <value name="ChangeFailed">5</value>
        <value name="Changed">6</value>
        <value name="RequestDenied">7</value>
    </enum>

    <enum name="LoginReply" type="short">
        <comment>
            Reply code sent with LOGIN_REPLY packet.
            Indicates the result of a login attempt.
        </comment>
        <value name="WrongUser">1</value>
        <value name="WrongUserPassword">2</value>
        <value name="Ok">3</value>
        <value name="Banned">
          <comment>The official client won't display a message until the connection from the server is closed</comment>
          4
        </value>
        <value name="LoggedIn">5</value>
        <value name="Busy">
          <comment>The official client won't display a message until the connection from the server is closed</comment>
          6
        </value>
    </enum>

    <enum name="DialogEntryType" type="short">
        <comment>The type of an entry in a quest dialog</comment>
        <value name="Text">1</value>
        <value name="Link">2</value>
    </enum>

    <enum name="QuestRequirementIcon" type="short">
        <comment>Icon displayed for each quest in the Quest Progress window</comment>
        <value name="Item">3</value>
        <value name="Talk">5</value>
        <value name="Kill">8</value>
        <value name="Step">10</value>
    </enum>

    <enum name="WarpEffect" type="char">
        <comment>An effect that accompanies a player warp</comment>
        <value name="None">
            <comment>Does nothing</comment>
            0
        </value>
        <value name="Scroll">
            <comment>Plays the scroll sound effect</comment>
            1
        </value>
        <value name="Admin">
            <comment>Plays the admin warp sound effect and animation</comment>
            2
        </value>
    </enum>

    <enum name="WarpType" type="char">
        <comment>
            Indicates whether a warp is within the current map, or switching to another map
        </comment>
        <value name="Local">1</value>
        <value name="MapSwitch">2</value>
    </enum>

    <enum name="WelcomeCode" type="short">
        <comment>Reply code sent with WELCOME_REPLY packet</comment>
        <value name="SelectCharacter">1</value>
        <value name="EnterGame">2</value>
        <value name="ServerBusy">3</value>
        <value name="LoggedIn">4</value>
    </enum>

    <enum name="LoginMessageCode" type="char">
        <comment>Whether a warning message should be displayed upon entering the game</comment>
        <value name="No">0</value>
        <value name="Yes">2</value>
    </enum>

    <enum name="AdminMessageType" type="char">
        <comment>Type of message sent to admins via the Help menu</comment>
        <value name="Message">1</value>
        <value name="Report">2</value>
    </enum>

    <enum name="PlayerKilledState" type="char">
        <comment>Flag to indicate that a player has been killed</comment>
        <value name="Alive">1</value>
        <value name="Killed">2</value>
    </enum>

    <enum name="NpcKillStealProtectionState" type="char">
        <comment>Flag to indicate whether you are able to attack an NPC</comment>
        <value name="Unprotected">1</value>
        <value name="Protected">2</value>
    </enum>

    <enum name="MapDamageType" type="char">
        <comment>Type of damage being caused by the environment</comment>
        <value name="TpDrain">1</value>
        <value name="Spikes">2</value>
    </enum>

    <enum name="MarriageReply" type="short">
        <comment>Reply code sent with MARRIAGE_REPLY packet</comment>
        <value name="AlreadyMarried">1</value>
        <value name="NotMarried">2</value>
        <value name="Success">3</value>
        <value name="NotEnoughGold">4</value>
        <value name="WrongName">5</value>
        <value name="ServiceBusy">6</value>
        <value name="DivorceNotification">7</value>
    </enum>

    <enum name="PriestReply" type="short">
        <comment>Reply code sent with PRIEST_REPLY packet</comment>
        <value name="NotDressed">1</value>
        <value name="LowLevel">2</value>
        <value name="PartnerNotPresent">3</value>
        <value name="PartnerNotDressed">4</value>
        <value name="Busy">5</value>
        <value name="DoYou">6</value>
        <value name="PartnerAlreadyMarried">7</value>
        <value name="NoPermission">8</value>
    </enum>

    <enum name="PartyReplyCode" type="char">
        <comment>
            Reply code sent with PARTY_REPLY packet.
            Indicates why an invite or join request failed.
        </comment>
        <value name="AlreadyInAnotherParty">0</value>
        <value name="AlreadyInYourParty">1</value>
        <value name="PartyIsFull">2</value>
    </enum>

    <struct name="BigCoords">
        <comment>Map coordinates with 2-byte values</comment>
        <field name="x" type="short"/>
        <field name="y" type="short"/>
    </struct>

    <struct name="EquipmentChange">
        <comment>
            Player equipment data.
            Sent when a player's visible equipment changes.
            Note that these values are graphic IDs.
        </comment>
        <field name="boots" type="short"/>
        <field name="armor" type="short"/>
        <field name="hat" type="short"/>
        <field name="weapon" type="short"/>
        <field name="shield" type="short"/>
    </struct>

    <struct name="EquipmentMapInfo">
        <comment>
            Player equipment data.
            Sent with map information about a nearby character.
            Note that these values are graphic IDs.
        </comment>
        <field name="boots" type="short"/>
        <field type="short">0</field>
        <field type="short">0</field>
        <field type="short">0</field>
        <field name="armor" type="short"/>
        <field type="short">0</field>
        <field name="hat" type="short"/>
        <field name="shield" type="short"/>
        <field name="weapon" type="short"/>
    </struct>

    <struct name="EquipmentCharacterSelect">
        <comment>
            Player equipment data.
            Sent with a character in the character selection list.
            Note that these values are graphic IDs.
        </comment>
        <field name="boots" type="short"/>
        <field name="armor" type="short"/>
        <field name="hat" type="short"/>
        <field name="shield" type="short"/>
        <field name="weapon" type="short"/>
    </struct>

    <struct name="EquipmentWelcome">
        <comment>
            Player equipment data.
            Sent upon selecting a character and entering the game.
            Note that these values are item IDs.
        </comment>
        <field name="boots" type="short"/>
        <field name="gloves" type="short"/>
        <field name="accessory" type="short"/>
        <field name="armor" type="short"/>
        <field name="belt" type="short"/>
        <field name="necklace" type="short"/>
        <field name="hat" type="short"/>
        <field name="shield" type="short"/>
        <field name="weapon" type="short"/>
        <array name="ring" type="short" length="2"/>
        <array name="armlet" type="short" length="2"/>
        <array name="bracer" type="short" length="2"/>
    </struct>

    <struct name="EquipmentPaperdoll">
        <comment>
            Player equipment data.
            Sent with information about a player's paperdoll.
            Note that these values are item IDs.
        </comment>
        <field name="boots" type="short"/>
        <field name="accessory" type="short"/>
        <field name="gloves" type="short"/>
        <field name="belt" type="short"/>
        <field name="armor" type="short"/>
        <field name="necklace" type="short"/>
        <field name="hat" type="short"/>
        <field name="shield" type="short"/>
        <field name="weapon" type="short"/>
        <array name="ring" type="short" length="2"/>
        <array name="armlet" type="short" length="2"/>
        <array name="bracer" type="short" length="2"/>
    </struct>

    <struct name="CharacterMapInfo">
        <comment>
            Information about a nearby character.
            The official client skips these if they're under 42 bytes in length.
        </comment>
        <chunked>
            <field name="name" type="string"/>
            <break/>
            <field name="player_id" type="short"/>
            <field name="map_id" type="short"/>
            <field name="coords" type="BigCoords"/>
            <field name="direction" type="Direction"/>
            <field name="class_id" type="char"/>
            <field name="guild_tag" type="string" length="3"/>
            <field name="level" type="char"/>
            <field name="gender" type="Gender"/>
            <field name="hair_style" type="char"/>
            <field name="hair_color" type="char"/>
            <field name="skin" type="char"/>
            <field name="max_hp" type="short"/>
            <field name="hp" type="short"/>
            <field name="max_tp" type="short"/>
            <field name="tp" type="short"/>
            <field name="equipment" type="EquipmentMapInfo"/>
            <field name="sit_state" type="SitState"/>
            <field name="invisible" type="bool"/>
            <field name="warp_effect" type="WarpEffect" optional="true"/>
        </chunked>
    </struct>

    <struct name="NpcMapInfo">
        <comment>Information about a nearby NPC</comment>
        <field name="index" type="char"/>
        <field name="id" type="short"/>
        <field name="coords" type="Coords"/>
        <field name="direction" type="Direction"/>
    </struct>

    <struct name="ItemMapInfo">
        <comment>Information about a nearby item on the ground</comment>
        <field name="uid" type="short"/>
        <field name="id" type="short"/>
        <field name="coords" type="Coords"/>
        <field name="amount" type="three"/>
    </struct>

    <struct name="AvatarChange">
        <comment>Information about a nearby player's appearance changing</comment>
        <field name="player_id" type="short"/>
        <field name="change_type" type="AvatarChangeType"/>
        <field name="sound" type="bool"/>
        <switch field="change_type">
            <case value="Equipment">
                <field name="equipment" type="EquipmentChange"/>
            </case>
            <case value="Hair">
                <field name="hair_style" type="char"/>
                <field name="hair_color" type="char"/>
            </case>
            <case value="HairColor">
                <field name="hair_color" type="char"/>
            </case>
        </switch>
    </struct>

    <struct name="NearbyInfo">
        <comment>Information about nearby entities</comment>
        <length name="characters_count" type="char"/>
        <chunked>
            <break/>
            <array name="characters" type="CharacterMapInfo" length="characters_count" delimited="true"/>
            <array name="npcs" type="NpcMapInfo"/>
            <break/>
            <array name="items" type="ItemMapInfo"/>
        </chunked>
    </struct>

    <struct name="MapFile">
        <comment>A map file (EMF)</comment>
        <field name="content" type="blob"/>
    </struct>

    <struct name="PubFile">
        <comment>A pub file (EIF, ENF, ECF, ESF)</comment>
        <field name="file_id" type="char"/>
        <field name="content" type="blob"/>
    </struct>

    <struct name="PlayersList">
        <comment>Information about online players</comment>
        <chunked>
            <length name="players_count" type="short"/>
            <break/>
            <array name="players" type="OnlinePlayer" length="players_count" delimited="true"/>
        </chunked>
    </struct>

    <struct name="PlayersListFriends">
        <comment>
            Information about online players.
            Sent in reply to friends list requests.
        </comment>
        <chunked>
            <length name="players_count" type="short"/>
            <break/>
            <array name="players" type="string" length="players_count" delimited="true"/>
        </chunked>
    </struct>

    <struct name="OnlinePlayer">
        <comment>A player in the online list</comment>
        <chunked>
            <field name="name" type="string"/>
            <break/>
            <field name="title" type="string"/>
            <break/>
            <field name="level" type="char"/>
            <field name="icon" type="CharacterIcon"/>
            <field name="class_id" type="char"/>
            <field name="guild_tag" type="string"/>
        </chunked>
    </struct>

    <struct name="CharacterSelectionListEntry">
        <comment>Character selection screen character</comment>
        <chunked>
            <field name="name" type="string"/>
            <break/>
            <field name="id" type="int"/>
            <field name="level" type="char"/>
            <field name="gender" type="Gender"/>
            <field name="hair_style" type="char"/>
            <field name="hair_color" type="char"/>
            <field name="skin" type="char"/>
            <field name="admin" type="AdminLevel"/>
            <field name="equipment" type="EquipmentCharacterSelect"/>
        </chunked>
    </struct>

    <struct name="ServerSettings">
        <comment>Settings sent with WELCOME_REPLY packet</comment>
        <field name="jail_map" type="short"/>
        <field name="rescue_map" type="short"/>
        <field name="rescue_coords" type="Coords"/>
        <field name="spy_and_light_guide_flood_rate" type="short"/>
        <field name="guardian_flood_rate" type="short"/>
        <field name="game_master_flood_rate" type="short"/>
        <field name="high_game_master_flood_rate" type="short"/>
    </struct>

    <struct name="ShopTradeItem">
        <comment>An item that a shop can buy or sell</comment>
        <field name="item_id" type="short"/>
        <field name="buy_price" type="three"/>
        <field name="sell_price" type="three"/>
        <field name="max_buy_amount" type="char"/>
    </struct>

    <struct name="ShopCraftItem">
        <comment>An item that a shop can craft</comment>
        <field name="item_id" type="short"/>
        <array name="ingredients" type="CharItem" length="4"/>
    </struct>

    <struct name="ShopSoldItem">
        <comment>A sold item when selling an item to a shop</comment>
        <field name="amount" type="int"/>
        <field name="id" type="short"/>
    </struct>

    <struct name="CharacterBaseStats">
        <comment>The 6 base character stats</comment>
        <field name="str" type="short"/>
        <field name="intl" type="short"/>
        <field name="wis" type="short"/>
        <field name="agi" type="short"/>
        <field name="con" type="short"/>
        <field name="cha" type="short"/>
    </struct>

    <struct name="CharacterBaseStatsWelcome">
        <comment>
            The 6 base character stats.
            Sent upon selecting a character and entering the game.
        </comment>
        <field name="str" type="short"/>
        <field name="wis" type="short"/>
        <field name="intl" type="short"/>
        <field name="agi" type="short"/>
        <field name="con" type="short"/>
        <field name="cha" type="short"/>
    </struct>

    <struct name="CharacterSecondaryStats">
        <comment>The 5 secondary character stats</comment>
        <field name="min_damage" type="short"/>
        <field name="max_damage" type="short"/>
        <field name="accuracy" type="short"/>
        <field name="evade" type="short"/>
        <field name="armor" type="short"/>
    </struct>

    <struct name="CharacterSecondaryStatsInfoLookup">
        <comment>
            The 5 secondary character stats.
            Sent with character info lookups.
        </comment>
        <field name="max_damage" type="short"/>
        <field name="min_damage" type="short"/>
        <field name="accuracy" type="short"/>
        <field name="evade" type="short"/>
        <field name="armor" type="short"/>
    </struct>

    <struct name="CharacterElementalStats">
        <comment>The 6 elemental character stats</comment>
        <field name="light" type="short"/>
        <field name="dark" type="short"/>
        <field name="fire" type="short"/>
        <field name="water" type="short"/>
        <field name="earth" type="short"/>
        <field name="wind" type="short"/>
    </struct>

    <struct name="CharacterStatsReset">
        <comment>
            Character stats data.
            Sent when resetting stats and skills at a skill master NPC.
        </comment>
        <field name="stat_points" type="short"/>
        <field name="skill_points" type="short"/>
        <field name="hp" type="short"/>
        <field name="max_hp" type="short"/>
        <field name="tp" type="short"/>
        <field name="max_tp" type="short"/>
        <field name="max_sp" type="short"/>
        <field name="base" type="CharacterBaseStats"/>
        <field name="secondary" type="CharacterSecondaryStats"/>
    </struct>

    <struct name="CharacterStatsWelcome">
        <comment>
            Character stats data.
            Sent upon selecting a character and entering the game.
        </comment>
        <field name="hp" type="short"/>
        <field name="max_hp" type="short"/>
        <field name="tp" type="short"/>
        <field name="max_tp" type="short"/>
        <field name="max_sp" type="short"/>
        <field name="stat_points" type="short"/>
        <field name="skill_points" type="short"/>
        <field name="karma" type="short"/>
        <field name="secondary" type="CharacterSecondaryStats"/>
        <field name="base" type="CharacterBaseStatsWelcome"/>
    </struct>

    <struct name="CharacterStatsUpdate">
        <comment>
            Character stats data.
            Sent when stats are updated.
        </comment>
        <field name="base_stats" type="CharacterBaseStats"/>
        <field name="max_hp" type="short"/>
        <field name="max_tp" type="short"/>
        <field name="max_sp" type="short"/>
        <field name="max_weight" type="short"/>
        <field name="secondary_stats" type="CharacterSecondaryStats"/>
    </struct>

    <struct name="CharacterStatsInfoLookup">
        <comment>
            Character stats data.
            Sent with character info lookups.
        </comment>
        <field name="hp" type="short"/>
        <field name="max_hp" type="short"/>
        <field name="tp" type="short"/>
        <field name="max_tp" type="short"/>
        <field name="base_stats" type="CharacterBaseStats"/>
        <field name="secondary_stats" type="CharacterSecondaryStatsInfoLookup"/>
        <field name="elemental_stats" type="CharacterElementalStats"/>
    </struct>

    <struct name="CharacterStatsEquipmentChange">
        <comment>
            Character stats data.
            Sent when an item is equipped or unequipped.
        </comment>
        <field name="max_hp" type="short"/>
        <field name="max_tp" type="short"/>
        <field name="base_stats" type="CharacterBaseStats"/>
        <field name="secondary_stats" type="CharacterSecondaryStats"/>
    </struct>

    <struct name="SkillLearn">
        <comment>A skill that can be learned from a skill master NPC</comment>
        <field name="id" type="short"/>
        <field name="level_requirement" type="char"/>
        <field name="class_requirement" type="char"/>
        <field name="cost" type="int"/>
        <array name="skill_requirements" type="short" length="4"/>
        <field name="stat_requirements" type="CharacterBaseStats"/>
    </struct>

    <struct name="BoardPostListing">
        <comment>An entry in the list of town board posts</comment>
        <chunked>
            <field name="post_id" type="short"/>
            <break/>
            <field name="author" type="string"/>
            <break/>
            <field name="subject" type="string"/>
        </chunked>
    </struct>

    <struct name="CharacterDetails">
        <comment>Information displayed on the paperdoll and book</comment>
        <chunked>
            <field name="name" type="string"/>
            <break/>
            <field name="home" type="string"/>
            <break/>
            <field name="partner" type="string"/>
            <break/>
            <field name="title" type="string"/>
            <break/>
            <field name="guild" type="string"/>
            <break/>
            <field name="guild_rank" type="string"/>
            <break/>
            <field name="player_id" type="short"/>
            <field name="class_id" type="char"/>
            <field name="gender" type="Gender"/>
            <field name="admin" type="AdminLevel"/>
        </chunked>
    </struct>

    <struct name="PartyMember">
        <comment>A member of the player's party</comment>
        <field name="player_id" type="short"/>
        <field name="leader" type="bool"/>
        <field name="level" type="char"/>
        <field name="hp_percentage" type="char"/>
        <field name="name" type="string"/>
    </struct>

    <struct name="PartyExpShare">
        <comment>EXP gain for a member of the player's party</comment>
        <field name="player_id" type="short"/>
        <field name="experience" type="int"/>
        <field name="level_up" type="char">
            <comment>
                A value greater than 0 is "new level" and indicates the player leveled up.
            </comment>
        </field>
    </struct>

    <struct name="GuildStaff">
        <comment>Information about a guild staff member (recruiter or leader)</comment>
        <chunked>
            <field name="rank" type="char"/>
            <break/>
            <field name="name" type="string"/>
        </chunked>
    </struct>

    <struct name="GuildMember">
        <comment>Information about a guild member</comment>
        <chunked>
            <field name="rank" type="char"/>
            <break/>
            <field name="name" type="string"/>
            <break/>
            <field name="rank_name" type="string"/>
        </chunked>
    </struct>

    <struct name="GroupHealTargetPlayer">
        <comment>Nearby player hit by a group heal spell</comment>
        <field name="player_id" type="short"/>
        <field name="hp_percentage" type="char"/>
        <field name="hp" type="short"/>
    </struct>

    <struct name="TradeItemData">
        <comment>Trade window item data</comment>
        <chunked>
            <field name="partner_player_id" type="short"/>
            <array name="partner_items" type="Item"/>
            <break/>
            <field name="your_player_id" type="short"/>
            <array name="your_items" type="Item"/>
            <break/>
        </chunked>
    </struct>

    <struct name="NpcKilledData">
        <comment>Information about an NPC that has been killed</comment>
        <field name="killer_id" type="short"/>
        <field name="killer_direction" type="Direction"/>
        <field name="npc_index" type="short"/>
        <field name="drop_index" type="short"/>
        <field name="drop_id" type="short"/>
        <field name="drop_coords" type="Coords"/>
        <field name="drop_amount" type="int"/>
        <field name="damage" type="three"/>
    </struct>

    <struct name="LevelUpStats">
        <comment>Level and stat updates</comment>
        <field name="level" type="char"/>
        <field name="stat_points" type="short"/>
        <field name="skill_points" type="short"/>
        <field name="max_hp" type="short"/>
        <field name="max_tp" type="short"/>
        <field name="max_sp" type="short"/>
    </struct>

    <struct name="NpcUpdatePosition">
        <comment>An NPC walking</comment>
        <field name="npc_index" type="char"/>
        <field name="coords" type="Coords"/>
        <field name="direction" type="Direction"/>
    </struct>

    <struct name="NpcUpdateAttack">
        <comment>An NPC attacking</comment>
        <field name="npc_index" type="char"/>
        <field name="killed" type="PlayerKilledState"/>
        <field name="direction" type="Direction"/>
        <field name="player_id" type="short"/>
        <field name="damage" type="three"/>
        <field name="hp_percentage" type="char"/>
    </struct>

    <struct name="NpcUpdateChat">
        <comment>An NPC talking</comment>
        <field name="npc_index" type="char"/>
        <length name="message_length" type="char"/>
        <field name="message" type="string" length="message_length"/>
    </struct>

    <struct name="QuestProgressEntry">
        <comment>An entry in the Quest Progress window</comment>
        <chunked>
            <field name="name" type="string"/>
            <break/>
            <field name="description" type="string"/>
            <break/>
            <field name="icon" type="QuestRequirementIcon"/>
            <field name="progress" type="short"/>
            <field name="target" type="short"/>
        </chunked>
    </struct>

    <struct name="DialogQuestEntry">
        <comment>An entry in the quest switcher</comment>
        <field name="quest_id" type="short"/>
        <field name="quest_name" type="string"/>
    </struct>

    <struct name="DialogEntry">
        <comment>An entry in a quest dialog</comment>
        <field name="entry_type" type="DialogEntryType"/>
        <switch field="entry_type">
            <case value="Link">
                <field name="link_id" type="short"/>
            </case>
        </switch>
        <field name="line" type="string"/>
    </struct>

    <struct name="MapDrainDamageOther">
        <comment>Another player taking damage from a map HP drain</comment>
        <field name="player_id" type="short"/>
        <field name="hp_percentage" type="char"/>
        <field name="damage" type="short"/>
    </struct>

    <struct name="GlobalBackfillMessage">
        <comment>A backfilled global chat message</comment>
        <chunked>
            <field name="player_name" type="string"/>
            <break/>
            <field name="message" type="string"/>
        </chunked>
    </struct>

    <struct name="PlayerEffect">
        <comment>An effect playing on a player</comment>
        <field name="player_id" type="short"/>
        <field name="effect_id" type="three"/>
    </struct>

    <struct name="TileEffect">
        <comment>An effect playing on a tile</comment>
        <field name="coords" type="Coords"/>
        <field name="effect_id" type="short"/>
    </struct>

    <packet family="Init" action="Init">
        <comment>
            Reply to connection initialization and requests for unencrypted data.
            This packet is unencrypted.
        </comment>
        <field name="reply_code" type="InitReply"/>
        <switch field="reply_code">
            <case value="OutOfDate">
                <field name="version" type="Version"/>
            </case>
            <case value="Ok">
                <field name="seq1" type="byte"/>
                <field name="seq2" type="byte"/>
                <field name="server_encryption_multiple" type="byte"/>
                <field name="client_encryption_multiple" type="byte"/>
                <field name="player_id" type="short"/>
                <field name="challenge_response" type="three"/>
            </case>
            <case value="Banned">
                <field name="ban_type" type="InitBanType"/>
                <switch field="ban_type">
                    <case value="0">
                        <comment>
                            The official client treats any value below 2 as a temporary ban.
                            The official server sends 1, but some game server implementations
                            erroneously send 0.
                        </comment>
                        <field name="minutes_remaining" type="byte"/>
                    </case>
                    <case value="Temporary">
                        <field name="minutes_remaining" type="byte"/>
                    </case>
                </switch>
            </case>
            <case value="WarpMap">
                <field name="map_file" type="MapFile"/>
            </case>
            <case value="FileEmf">
                <field name="map_file" type="MapFile"/>
            </case>
            <case value="FileEif">
                <field name="pub_file" type="PubFile"/>
            </case>
            <case value="FileEnf">
                <field name="pub_file" type="PubFile"/>
            </case>
            <case value="FileEsf">
                <field name="pub_file" type="PubFile"/>
            </case>
            <case value="FileEcf">
                <field name="pub_file" type="PubFile"/>
            </case>
            <case value="MapMutation">
                <field name="map_file" type="MapFile"/>
            </case>
            <case value="PlayersList">
                <chunked>
                    <field name="players_list" type="PlayersList"/>
                </chunked>
            </case>
            <case value="PlayersListFriends">
                <chunked>
                    <field name="players_list" type="PlayersListFriends"/>
                </chunked>
            </case>
        </switch>
    </packet>

    <packet family="Warp" action="Player">
        <comment>Equivalent to INIT_INIT with InitReply.WarpMap</comment>
        <field name="map_file" type="MapFile"/>
    </packet>

    <packet family="Welcome" action="Ping">
        <comment>Equivalent to INIT_INIT with InitReply.FileMap</comment>
        <field name="map_file" type="MapFile"/>
    </packet>

    <packet family="Welcome" action="Pong">
        <comment>Equivalent to INIT_INIT with InitReply.FileEif</comment>
        <field name="pub_file" type="PubFile"/>
    </packet>

    <packet family="Welcome" action="Net242">
        <comment>Equivalent to INIT_INIT with InitReply.FileEnf</comment>
        <field name="pub_file" type="PubFile"/>
    </packet>

    <packet family="Welcome" action="Net243">
        <comment>Equivalent to INIT_INIT with InitReply.FileEsf</comment>
        <field name="pub_file" type="PubFile"/>
    </packet>

    <packet family="Players" action="List">
        <comment>Equivalent to INIT_INIT with InitReply.PlayersList</comment>
        <chunked>
            <field name="players_list" type="PlayersList"/>
        </chunked>
    </packet>

    <packet family="Warp" action="Create">
        <comment>Equivalent to INIT_INIT with InitReply.MapMutation</comment>
        <field name="map_file" type="MapFile"/>
    </packet>

    <packet family="Players" action="Reply">
        <comment>Equivalent to INIT_INIT with InitReply.PlayersListFriends</comment>
        <chunked>
            <field name="players_list" type="PlayersListFriends"/>
        </chunked>
    </packet>

    <packet family="Welcome" action="Net244">
        <comment>Equivalent to INIT_INIT with InitReply.FileEcf</comment>
        <field name="pub_file" type="PubFile"/>
    </packet>

    <packet family="Connection" action="Player">
        <comment>Ping request</comment>
        <field name="seq1" type="short"/>
        <field name="seq2" type="char"/>
    </packet>

    <packet family="Account" action="Reply">
        <comment>Reply to client Account-family packets</comment>
        <field name="reply_code" type="AccountReply">
            <comment>
                Sometimes an AccountReply code, sometimes a session ID for account creation
            </comment>
        </field>
        <switch field="reply_code">
            <case value="0">
                <!-- No effect in the official client -->
            </case>
            <case value="Exists">
                <field type="string">NO</field>
            </case>
            <case value="NotApproved">
                <field type="string">NO</field>
            </case>
            <case value="Created">
                <field type="string">GO</field>
            </case>
            <case value="4">
                <!-- No effect in the official client -->
            </case>
            <case value="ChangeFailed">
                <field type="string">NO</field>
            </case>
            <case value="Changed">
                <field type="string">OK</field>
            </case>
            <case value="RequestDenied">
                <field type="string">NO</field>
            </case>
            <case value="8">
                <!-- No effect in the official client -->
            </case>
            <case value="9">
                <!-- No effect in the official client -->
            </case>
            <case default="true">
                <comment>
                    In this case (reply_code &gt; 9), reply_code is a session ID for account creation
                </comment>
                <field name="sequence_start" type="char"/>
                <field type="string">OK</field>
            </case>
        </switch>
    </packet>

    <packet family="Character" action="Reply">
        <comment>Reply to client Character-family packets</comment>
        <chunked>
            <field name="reply_code" type="CharacterReply">
                <comment>
                    Sometimes a CharacterReply code, sometimes a session ID for character creation
                </comment>
            </field>
            <switch field="reply_code">
                <case value="0">
                    <!-- No effect in the official client -->
                </case>
                <case value="Exists">
                    <field type="string">NO</field>
                </case>
                <case value="Full">
                    <field type="string">NO</field>
                </case>
                <case value="Full3">
                    <field type="string">NO</field>
                </case>
                <case value="NotApproved">
                    <field type="string">NO</field>
                </case>
                <case value="Ok">
                    <length name="characters_count" type="char"/>
                    <field type="char">0</field>
                    <break/>
                    <array name="characters" type="CharacterSelectionListEntry" length="characters_count" delimited="true"/>
                </case>
                <case value="Deleted">
                    <length name="characters_count" type="char"/>
                    <break/>
                    <array name="characters" type="CharacterSelectionListEntry" length="characters_count" delimited="true"/>
                </case>
                <case value="7">
                    <!-- No effect in the official client -->
                </case>
                 <case value="8">
                    <!-- No effect in the official client -->
                </case>
                <case value="9">
                    <!-- No effect in the official client -->
                </case>
                <case default="true">
                    <comment>
                        In this case (reply_code &gt; 9), reply_code is a session ID for character creation
                    </comment>
                    <field type="string">OK</field>
                </case>
            </switch>
        </chunked>
    </packet>

    <packet family="Character" action="Player">
        <comment>Reply to client request to delete a character from the account (Character_Take)</comment>
        <field name="session_id" type="short"/>
        <field name="character_id" type="int"/>
    </packet>

    <packet family="Login" action="Reply">
        <comment>Login reply</comment>
        <chunked>
            <field name="reply_code" type="LoginReply"/>
            <switch field="reply_code">
                <case value="WrongUser">
                    <field type="string">NO</field>
                </case>
                <case value="WrongUserPassword">
                    <field type="string">NO</field>
                </case>
                <case value="Ok">
                    <length name="characters_count" type="char"/>
                    <field type="char">0</field>
                    <break/>
                    <array name="characters" type="CharacterSelectionListEntry" length="characters_count" delimited="true"/>
                </case>
                <case value="Banned">
                    <field type="string">NO</field>
                </case>
                <case value="LoggedIn">
                    <field type="string">NO</field>
                </case>
                <case value="Busy">
                    <field type="string">NO</field>
                </case>
            </switch>
        </chunked>
    </packet>

    <packet family="Welcome" action="Reply">
        <comment>Reply to selecting a character / entering game</comment>
        <field name="welcome_code" type="WelcomeCode"/>
        <chunked>
            <switch field="welcome_code">
                <case value="SelectCharacter">
                    <field name="session_id" type="short"/>
                    <field name="character_id" type="int"/>
                    <field name="map_id" type="short"/>
                    <array name="map_rid" type="short" length="2"/>
                    <field name="map_file_size" type="three"/>
                    <array name="eif_rid" type="short" length="2"/>
                    <field name="eif_length" type="short"/>
                    <array name="enf_rid" type="short" length="2"/>
                    <field name="enf_length" type="short"/>
                    <array name="esf_rid" type="short" length="2"/>
                    <field name="esf_length" type="short"/>
                    <array name="ecf_rid" type="short" length="2"/>
                    <field name="ecf_length" type="short"/>
                    <field name="name" type="string"/>
                    <break/>
                    <field name="title" type="string"/>
                    <break/>
                    <field name="guild_name" type="string"/>
                    <break/>
                    <field name="guild_rank_name" type="string"/>
                    <break/>
                    <field name="class_id" type="char"/>
                    <field name="guild_tag" type="string" length="3"/>
                    <field name="admin" type="AdminLevel"/>
                    <field name="level" type="char"/>
                    <field name="experience" type="int"/>
                    <field name="usage" type="int"/>
                    <field name="stats" type="CharacterStatsWelcome"/>
                    <field name="equipment" type="EquipmentWelcome"/>
                    <field name="guild_rank" type="char"/>
                    <field name="settings" type="ServerSettings"/>
                    <field name="login_message_code" type="LoginMessageCode"/>
                    <break/>
                </case>
                <case value="EnterGame">
                    <break/>
                    <array name="news" type="string" length="9" delimited="true"/>
                    <field name="weight" type="Weight"/>
                    <array name="items" type="Item"/>
                    <break/>
                    <array name="spells" type="Spell"/>
                    <break/>
                    <field name="nearby" type="NearbyInfo"/>
                </case>
            </switch>
        </chunked>
    </packet>

    <packet family="AdminInteract" action="Reply">
        <comment>Incoming admin message</comment>
        <chunked>
            <field name="message_type" type="AdminMessageType"/>
            <break/>
            <switch field="message_type">
                <case value="Message">
                    <field name="player_name" type="string"/>
                    <break/>
                    <field name="message" type="string"/>
                    <break/>
                </case>
                <case value="Report">
                    <field name="player_name" type="string"/>
                    <break/>
                    <field name="message" type="string"/>
                    <break/>
                    <field name="reportee_name" type="string"/>
                    <break/>
                </case>
            </switch>
        </chunked>
    </packet>

    <packet family="AdminInteract" action="Remove">
        <comment>Nearby player disappearing (admin hide)</comment>
        <field name="player_id" type="short"/>
    </packet>

    <packet family="AdminInteract" action="Agree">
        <comment>Nearby player appearing (admin un-hide)</comment>
        <field name="player_id" type="short"/>
    </packet>

    <packet family="AdminInteract" action="List">
        <comment>Admin character inventory popup</comment>
        <chunked>
            <field name="name" type="string"/>
            <break/>
            <field name="usage" type="int"/>
            <break/>
            <field name="gold_bank" type="int"/>
            <break/>
            <array name="inventory" type="Item"/>
            <break/>
            <array name="bank" type="ThreeItem"/>
        </chunked>
    </packet>

    <packet family="AdminInteract" action="Tell">
        <comment>Admin character info lookup</comment>
        <chunked>
            <field name="name" type="string"/>
            <break/>
            <field name="usage" type="int"/>
            <break/>
            <field name="gold_bank" type="int"/>
            <break/>
            <field name="exp" type="int"/>
            <field name="level" type="char"/>
            <field name="map_id" type="short"/>
            <field name="map_coords" type="BigCoords"/>
            <field name="stats" type="CharacterStatsInfoLookup"/>
            <field name="weight" type="Weight"/>
        </chunked>
    </packet>

    <packet family="Talk" action="Request">
        <comment>Guild chat message</comment>
        <chunked>
            <field name="player_name" type="string"/>
            <break/>
            <field name="message" type="string"/>
        </chunked>
    </packet>

    <packet family="Talk" action="Open">
        <comment>Party chat message</comment>
        <field name="player_id" type="short"/>
        <field name="message" type="string"/>
    </packet>

    <packet family="Talk" action="Msg">
        <comment>Global chat message</comment>
        <chunked>
            <field name="player_name" type="string"/>
            <break/>
            <field name="message" type="string"/>
        </chunked>
    </packet>

    <packet family="Talk" action="Tell">
        <comment>Private chat message</comment>
        <chunked>
            <field name="player_name" type="string"/>
            <break/>
            <field name="message" type="string"/>
        </chunked>
    </packet>

    <packet family="Talk" action="Player">
        <comment>Public chat message</comment>
        <field name="player_id" type="short"/>
        <field name="message" type="string"/>
    </packet>

    <packet family="Talk" action="Reply">
        <comment>Reply to trying to send a private message</comment>
        <field name="reply_code" type="TalkReply"/>
        <field name="name" type="string"/>
    </packet>

    <packet family="Talk" action="Admin">
        <comment>Admin chat message</comment>
        <chunked>
            <field name="player_name" type="string"/>
            <break/>
            <field name="message" type="string"/>
        </chunked>
    </packet>

    <packet family="Talk" action="Announce">
        <comment>Admin announcement</comment>
        <chunked>
            <field name="player_name" type="string"/>
            <break/>
            <field name="message" type="string"/>
        </chunked>
    </packet>

    <packet family="Talk" action="Server">
        <comment>Server message</comment>
        <field name="message" type="string"/>
    </packet>

    <packet family="Talk" action="List">
        <comment>
            Global chat backfill.
            Sent by the official game server when a player opens the global chat tab.
        </comment>
        <chunked>
            <array name="messages" type="GlobalBackfillMessage" delimited="true"/>
        </chunked>
    </packet>

    <packet family="Message" action="Open">
        <comment>Status bar message</comment>
        <field name="message" type="string"/>
    </packet>

    <packet family="Message" action="Close">
        <comment>Server is rebooting</comment>
        <dummy type="string">r</dummy>
    </packet>

    <packet family="Message" action="Accept">
        <comment>Large message box</comment>
        <chunked>
            <array name="messages" type="string" length="4" delimited="true"/>
        </chunked>
    </packet>

    <packet family="Talk" action="Spec">
        <comment>Temporary mute applied</comment>
        <field name="admin_name" type="string"/>
    </packet>

    <packet family="Attack" action="Player">
        <comment>Nearby player attacking</comment>
        <field name="player_id" type="short"/>
        <field name="direction" type="Direction"/>
    </packet>

    <packet family="Attack" action="Error">
        <comment>Show flood protection message (vestigial)</comment>
        <dummy type="byte">255</dummy>
    </packet>

    <packet family="Avatar" action="Reply">
        <comment>Nearby player hit by another player</comment>
        <field name="player_id" type="short"/>
        <field name="victim_id" type="short"/>
        <field name="damage" type="three"/>
        <field name="direction" type="Direction"/>
        <field name="hp_percentage" type="char"/>
        <field name="dead" type="bool"/>
    </packet>

    <packet family="Chair" action="Player">
        <comment>Nearby player sitting on a chair</comment>
        <field name="player_id" type="short"/>
        <field name="coords" type="Coords"/>
        <field name="direction" type="Direction"/>
    </packet>

    <packet family="Chair" action="Reply">
        <comment>Your character sitting on a chair</comment>
        <field name="player_id" type="short"/>
        <field name="coords" type="Coords"/>
        <field name="direction" type="Direction"/>
    </packet>

    <packet family="Chair" action="Close">
        <comment>Your character standing up from a chair</comment>
        <field name="player_id" type="short"/>
        <field name="coords" type="Coords"/>
    </packet>

    <packet family="Chair" action="Remove">
        <comment>Nearby player standing up from a chair</comment>
        <field name="player_id" type="short"/>
        <field name="coords" type="Coords"/>
    </packet>

    <packet family="Sit" action="Player">
        <comment>Nearby player sitting down</comment>
        <field name="player_id" type="short"/>
        <field name="coords" type="Coords"/>
        <field name="direction" type="Direction"/>
        <!-- Sent by the official server and ignored by the official client -->
        <field type="char">0</field>
    </packet>

    <packet family="Sit" action="Close">
        <comment>Your character standing up</comment>
        <field name="player_id" type="short"/>
        <field name="coords" type="Coords"/>
    </packet>

    <packet family="Sit" action="Remove">
        <comment>Nearby player standing up</comment>
        <field name="player_id" type="short"/>
        <field name="coords" type="Coords"/>
    </packet>

    <packet family="Sit" action="Reply">
        <comment>Your character sitting down</comment>
        <field name="player_id" type="short"/>
        <field name="coords" type="Coords"/>
        <field name="direction" type="Direction"/>
        <!-- Sent by the official server and ignored by the official client -->
        <field type="char">0</field>
    </packet>

    <packet family="Emote" action="Player">
        <comment>Nearby player doing an emote</comment>
        <field name="player_id" type="short"/>
        <field name="emote" type="Emote"/>
    </packet>

    <packet family="Effect" action="Player">
        <comment>Effects playing on nearby players</comment>
        <array name="effects" type="PlayerEffect"/>
    </packet>

    <packet family="Face" action="Player">
        <comment>Nearby player facing a direction</comment>
        <field name="player_id" type="short"/>
        <field name="direction" type="Direction"/>
    </packet>

    <packet family="Avatar" action="Remove">
        <comment>Nearby player has disappeared from view</comment>
        <field name="player_id" type="short"/>
        <field name="warp_effect" type="WarpEffect" optional="true"/>
    </packet>

    <packet family="Players" action="Agree">
        <comment>Player has appeared in nearby view</comment>
        <field name="nearby" type="NearbyInfo"/>
    </packet>

    <packet family="Players" action="Remove">
        <comment>Nearby player has logged out</comment>
        <field name="player_id" type="short"/>
    </packet>

    <packet family="Range" action="Reply">
        <comment>Reply to request for information about nearby players and NPCs</comment>
        <field name="nearby" type="NearbyInfo"/>
    </packet>

    <packet family="Npc" action="Agree">
        <comment>Reply to request for information about nearby NPCs</comment>
        <length name="npcs_count" type="char"/>
        <array name="npcs" type="NpcMapInfo" length="npcs_count"/>
    </packet>

    <packet family="Walk" action="Player">
        <comment>Nearby player has walked</comment>
        <field name="player_id" type="short"/>
        <field name="direction" type="Direction"/>
        <field name="coords" type="Coords"/>
    </packet>

    <packet family="Walk" action="Reply">
        <comment>Players, NPCs, and Items appearing in nearby view</comment>
        <chunked>
            <array name="player_ids" type="short"/>
            <break/>
            <array name="npc_indexes" type="char"/>
            <break/>
            <array name="items" type="ItemMapInfo"/>
        </chunked>
    </packet>

    <packet family="Walk" action="Close">
        <comment>Your character has been frozen</comment>
        <dummy type="string">S</dummy>
    </packet>

    <packet family="Walk" action="Open">
        <comment>Your character has been unfrozen</comment>
        <dummy type="string">S</dummy>
    </packet>

    <packet family="Bank" action="Open">
        <comment>Open banker NPC interface</comment>
        <field name="gold_bank" type="int"/>
        <field name="session_id" type="three"/>
        <field name="locker_upgrades" type="char"/>
    </packet>

    <packet family="Bank" action="Reply">
        <comment>Update gold counts after deposit/withdraw</comment>
        <field name="gold_inventory" type="int"/>
        <field name="gold_bank" type="int"/>
    </packet>

    <packet family="Barber" action="Agree">
        <comment>Purchasing a new hair style</comment>
        <field name="gold_amount" type="int"/>
        <field name="change" type="AvatarChange"/>
    </packet>

    <packet family="Barber" action="Open">
        <comment>Response from talking to a barber NPC</comment>
        <field name="session_id" type="int"/>
    </packet>

    <packet family="Locker" action="Reply">
        <comment>Response to adding an item to a bank locker</comment>
        <field name="deposited_item" type="Item"/>
        <field name="weight" type="Weight"/>
        <array name="locker_items" type="ThreeItem"/>
    </packet>

    <packet family="Locker" action="Get">
        <comment>Response to taking an item from a bank locker</comment>
        <field name="taken_item" type="ThreeItem"/>
        <field name="weight" type="Weight"/>
        <array name="locker_items" type="ThreeItem"/>
    </packet>

    <packet family="Locker" action="Open">
        <comment>Opening a bank locker</comment>
        <field name="locker_coords" type="Coords"/>
        <array name="locker_items" type="ThreeItem"/>
    </packet>

    <packet family="Locker" action="Buy">
        <comment>Response to buying a locker space upgrade from a banker NPC</comment>
        <field name="gold_amount" type="int"/>
        <field name="locker_upgrades" type="char"/>
    </packet>

    <packet family="Locker" action="Spec">
        <comment>Reply to trying to add an item to a full locker</comment>
        <field name="locker_max_items" type="char"/>
    </packet>

    <packet family="Citizen" action="Reply">
        <comment>Response to subscribing to a town</comment>
        <field name="questions_wrong" type="char"/>
    </packet>

    <packet family="Citizen" action="Remove">
        <comment>Response to giving up citizenship of a town</comment>
        <field name="reply_code" type="InnUnsubscribeReply"/>
    </packet>

    <packet family="Citizen" action="Open">
        <comment>Response from talking to a citizenship NPC</comment>
        <chunked>
            <field name="behavior_id" type="three"/>
            <field name="current_home_id" type="char"/>
            <field name="session_id" type="short"/>
            <break/>
            <array name="questions" type="string" length="3" delimited="true" trailing-delimiter="false"/>
        </chunked>
    </packet>

    <packet family="Citizen" action="Request">
        <comment>Reply to requesting sleeping at an inn</comment>
        <field name="cost" type="int"/>
    </packet>

    <packet family="Citizen" action="Accept">
        <comment>Sleeping at an inn</comment>
        <field name="gold_amount" type="int"/>
    </packet>

    <packet family="Shop" action="Create">
        <comment>Response to crafting an item from a shop</comment>
        <field name="craft_item_id" type="short"/>
        <field name="weight" type="Weight"/>
        <array name="ingredients" type="Item" length="4"/>
    </packet>

    <packet family="Shop" action="Buy">
        <comment>Response to purchasing an item from a shop</comment>
        <field name="gold_amount" type="int"/>
        <field name="bought_item" type="Item"/>
        <field name="weight" type="Weight"/>
    </packet>

    <packet family="Shop" action="Sell">
        <comment>Response to selling an item to a shop</comment>
        <field name="sold_item" type="ShopSoldItem"/>
        <field name="gold_amount" type="int"/>
        <field name="weight" type="Weight"/>
    </packet>

    <packet family="Shop" action="Open">
        <comment>Response from talking to a shop NPC</comment>
        <chunked>
            <field name="session_id" type="short"/>
            <field name="shop_name" type="string"/>
            <break/>
            <array name="trade_items" type="ShopTradeItem"/>
            <break/>
            <array name="craft_items" type="ShopCraftItem"/>
        </chunked>
    </packet>

    <packet family="StatSkill" action="Open">
        <comment>Response from talking to a skill master NPC</comment>
        <chunked>
            <field name="session_id" type="short"/>
            <field name="shop_name" type="string"/>
            <break/>
            <array name="skills" type="SkillLearn"/>
        </chunked>
    </packet>

    <packet family="StatSkill" action="Reply">
        <comment>Response from unsuccessful action at a skill master</comment>
        <field name="reply_code" type="SkillMasterReply"/>
        <switch field="reply_code">
            <case value="WrongClass">
                <field name="class_id" type="char"/>
            </case>
        </switch>
    </packet>

    <packet family="StatSkill" action="Take">
        <comment>Response from learning a skill from a skill master</comment>
        <field name="spell_id" type="short"/>
        <field name="gold_amount" type="int"/>
    </packet>

    <packet family="StatSkill" action="Remove">
        <comment>Response to forgetting a skill at a skill master</comment>
        <field name="spell_id" type="short"/>
    </packet>

    <packet family="StatSkill" action="Player">
        <comment>Response to spending stat points</comment>
        <field name="stat_points" type="short"/>
        <field name="stats" type="CharacterStatsUpdate"/>
    </packet>

    <packet family="StatSkill" action="Accept">
        <comment>Response to spending skill points</comment>
        <field name="skill_points" type="short"/>
        <field name="spell" type="Spell"/>
    </packet>

    <packet family="StatSkill" action="Junk">
        <comment>Response to resetting stats and skills at a skill master</comment>
        <field name="stats" type="CharacterStatsReset"/>
    </packet>

    <packet family="Item" action="Reply">
        <comment>Reply to using an item</comment>
        <field name="item_type" type="ItemType"/>
        <field name="used_item" type="Item"/>
        <field name="weight" type="Weight"/>
        <switch field="item_type">
            <case value="Heal">
                <field name="hp_gain" type="int"/>
                <field name="hp" type="short"/>
                <field name="tp" type="short"/>
            </case>
            <case value="HairDye">
                <field name="hair_color" type="char"/>
            </case>
            <case value="EffectPotion">
                <field name="effect_id" type="short"/>
            </case>
            <case value="CureCurse">
                <field name="stats" type="CharacterStatsEquipmentChange"/>
            </case>
            <case value="ExpReward">
                <field name="experience" type="int"/>
                <field name="level_up" type="char">
                    <comment>
                        A value greater than 0 is "new level" and indicates the player leveled up.
                    </comment>
                </field>
                <field name="stat_points" type="short"/>
                <field name="skill_points" type="short"/>
                <field name="max_hp" type="short"/>
                <field name="max_tp" type="short"/>
                <field name="max_sp" type="short"/>
            </case>
        </switch>
    </packet>

    <packet family="Item" action="Drop">
        <comment>Reply to dropping items on the ground</comment>
        <field name="dropped_item" type="ThreeItem"/>
        <field name="remaining_amount" type="int"/>
        <field name="item_index" type="short"/>
        <field name="coords" type="Coords"/>
        <field name="weight" type="Weight"/>
    </packet>

    <packet family="Item" action="Add">
        <comment>Item appeared on the ground</comment>
        <field name="item_id" type="short"/>
        <field name="item_index" type="short"/>
        <field name="item_amount" type="three"/>
        <field name="coords" type="Coords"/>
    </packet>

    <packet family="Item" action="Remove">
        <comment>Item disappeared from the ground</comment>
        <field name="item_index" type="short"/>
    </packet>

    <packet family="Item" action="Junk">
        <comment>Reply to junking items</comment>
        <field name="junked_item" type="ThreeItem"/>
        <field name="remaining_amount" type="int"/>
        <field name="weight" type="Weight"/>
    </packet>

    <packet family="Item" action="Get">
        <comment>Reply to taking items from the ground</comment>
        <field name="taken_item_index" type="short"/>
        <field name="taken_item" type="ThreeItem"/>
        <field name="weight" type="Weight"/>
    </packet>

    <packet family="Item" action="Obtain">
        <comment>Receive item (from quest)</comment>
        <field name="item" type="ThreeItem"/>
        <field name="current_weight" type="char"/>
    </packet>

    <packet family="Item" action="Kick">
        <comment>Lose item (from quest)</comment>
        <field name="item" type="Item"/>
        <field name="current_weight" type="char"/>
    </packet>

    <packet family="Item" action="Agree">
        <comment>Reply to using an item that you don't have</comment>
        <field name="item_id" type="short"/>
    </packet>

    <packet family="Item" action="Spec">
        <comment>Reply to trying to take a protected item from the ground</comment>
        <dummy type="short">2</dummy>
    </packet>

    <packet family="Board" action="Player">
        <comment>Reply to reading a post on a town board</comment>
        <chunked>
            <field name="post_id" type="short"/>
            <field name="post_body" type="string"/>
        </chunked>
    </packet>

    <packet family="Board" action="Open">
        <comment>Reply to opening a town board</comment>
        <chunked>
            <field name="board_id" type="char"/>
            <length name="posts_count" type="char"/>
            <array name="posts" type="BoardPostListing" length="posts_count" delimited="true"/>
        </chunked>
    </packet>

    <packet family="Jukebox" action="Agree">
        <comment>Reply to successfully requesting a song</comment>
        <field name="gold_amount" type="int"/>
    </packet>

    <packet family="Jukebox" action="Reply">
        <comment>Reply to unsuccessfully requesting a song</comment>
        <!-- "Someone else already requested a song, please wait a moment." -->
        <!-- (Official server erroneously sends this when you don't have enough gold) -->
        <dummy type="short">1</dummy>
    </packet>

    <packet family="Jukebox" action="Open">
        <comment>Reply to opening the jukebox listing</comment>
        <field name="map_id" type="short"/>
        <field name="jukebox_player" type="string"/>
    </packet>

    <packet family="Jukebox" action="Msg">
        <comment>Someone playing a note with the bard skill nearby</comment>
        <field name="player_id" type="short"/>
        <field name="direction" type="Direction"/>
        <field name="instrument_id" type="char"/>
        <field name="note_id" type="char"/>
    </packet>

    <packet family="Jukebox" action="Player">
        <comment>Play background music</comment>
        <field name="mfx_id" type="char"/>
    </packet>

    <packet family="Jukebox" action="Use">
        <comment>Play jukebox music</comment>
        <field name="track_id" type="short">
            <comment>This value is 1-indexed</comment>
        </field>
    </packet>

    <packet family="Warp" action="Request">
        <comment>Warp request from server</comment>
        <field name="warp_type" type="WarpType"/>
        <field name="map_id" type="short"/>
        <switch field="warp_type">
            <case value="MapSwitch">
                <array name="map_rid" type="short" length="2"/>
                <field name="map_file_size" type="three"/>
            </case>
        </switch>
        <field name="session_id" type="short"/>
    </packet>

    <packet family="Warp" action="Agree">
        <comment>Reply after accepting a warp</comment>
        <chunked>
            <field name="warp_type" type="WarpType"/>
            <switch field="warp_type">
                <case value="MapSwitch">
                    <field name="map_id" type="short"/>
                    <field name="warp_effect" type="WarpEffect"/>
                </case>
            </switch>
            <field name="nearby" type="NearbyInfo"/>
        </chunked>
    </packet>

    <packet family="Paperdoll" action="Reply">
        <comment>Reply to requesting a paperdoll</comment>
        <chunked>
            <field name="details" type="CharacterDetails"/>
            <field name="equipment" type="EquipmentPaperdoll"/>
            <field name="icon" type="CharacterIcon"/>
        </chunked>
    </packet>

    <packet family="Paperdoll" action="Ping">
        <comment>Failed to equip an item due to being the incorrect class</comment>
        <!-- There is no visible effect in the client, it simply re-assigns the player's class -->
        <field name="class_id" type="char">
            <comment>The player's current class ID (not the item's required class ID)</comment>
        </field>
    </packet>

    <packet family="Paperdoll" action="Remove">
        <comment>Reply to unequipping an item</comment>
        <field name="change" type="AvatarChange"/>
        <field name="item_id" type="short"/>
        <field name="sub_loc" type="char"/>
        <field name="stats" type="CharacterStatsEquipmentChange"/>
    </packet>

    <packet family="Paperdoll" action="Agree">
        <comment>Reply to equipping an item</comment>
        <field name="change" type="AvatarChange"/>
        <field name="item_id" type="short"/>
        <field name="remaining_amount" type="three"/>
        <field name="sub_loc" type="char"/>
        <field name="stats" type="CharacterStatsEquipmentChange"/>
    </packet>

    <packet family="Avatar" action="Agree">
        <comment>Nearby player changed appearance</comment>
        <field name="change" type="AvatarChange"/>
    </packet>

    <packet family="Book" action="Reply">
        <comment>Reply to requesting a book</comment>
        <chunked>
            <field name="details" type="CharacterDetails"/>
            <field name="icon" type="CharacterIcon"/>
            <break/>
            <array name="quest_names" type="string" delimited="true"/>
        </chunked>
    </packet>

    <packet family="Message" action="Pong">
        <comment>#ping command reply</comment>
        <dummy type="short">2</dummy>
    </packet>

    <packet family="Players" action="Ping">
        <comment>#find command reply - offline</comment>
        <field name="name" type="string"/>
    </packet>

    <packet family="Players" action="Pong">
        <comment>#find command reply - same map</comment>
        <field name="name" type="string"/>
    </packet>

    <packet family="Players" action="Net242">
        <comment>#find command reply - different map</comment>
        <field name="name" type="string"/>
    </packet>

    <packet family="Door" action="Open">
        <comment>Nearby door opening</comment>
        <field name="coords" type="Coords">
            <comment>
                The official server erroneously encodes the Y coordinate as a short.
                The official client reads each coordinate as a char.
            </comment>
        </field>
    </packet>

    <packet family="Door" action="Close">
        <comment>Reply to trying to open a locked door</comment>
        <field name="key" type="char"/>
    </packet>

    <packet family="Chest" action="Open">
        <comment>Reply to opening a chest</comment>
        <field name="coords" type="Coords"/>
        <array name="items" type="ThreeItem"/>
    </packet>

    <packet family="Chest" action="Reply">
        <comment>Reply to placing an item in to a chest</comment>
        <field name="added_item_id" type="short"/>
        <field name="remaining_amount" type="int"/>
        <field name="weight" type="Weight"/>
        <array name="items" type="ThreeItem"/>
    </packet>

    <packet family="Chest" action="Get">
        <comment>Reply to removing an item from a chest</comment>
        <field name="taken_item" type="ThreeItem"/>
        <field name="weight" type="Weight"/>
        <array name="items" type="ThreeItem"/>
    </packet>

    <packet family="Chest" action="Agree">
        <comment>Chest contents updating</comment>
        <array name="items" type="ThreeItem"/>
    </packet>

    <packet family="Chest" action="Spec">
        <comment>Reply to trying to add an item to a full chest</comment>
        <dummy type="byte">0</dummy>
    </packet>

    <packet family="Chest" action="Close">
        <comment>
            Reply to trying to interact with a locked or "broken" chest.
            The official client assumes a broken chest if the packet is under 2 bytes in length.
        </comment>
        <field name="key" type="short" optional="true">
            <comment>Sent if the player is trying to interact with a locked chest</comment>
        </field>
        <dummy type="string">N</dummy>
    </packet>

    <packet family="Refresh" action="Reply">
        <comment>Reply to request for new info about nearby objects</comment>
        <field name="nearby" type="NearbyInfo"/>
    </packet>

    <packet family="Party" action="Request">
        <comment>Received party invite / join request</comment>
        <field name="request_type" type="PartyRequestType"/>
        <field name="inviter_player_id" type="short"/>
        <field name="player_name" type="string"/>
    </packet>

    <packet family="Party" action="Reply">
        <comment>Failed party invite / join request</comment>
        <field name="reply_code" type="PartyReplyCode"/>
        <switch field="reply_code">
            <case value="AlreadyInAnotherParty">
                <field name="player_name" type="string"/>
            </case>
            <case value="AlreadyInYourParty">
                <field name="player_name" type="string"/>
            </case>
        </switch>
    </packet>

    <packet family="Party" action="Create">
        <comment>Member list received when party is first joined</comment>
        <chunked>
            <array name="members" type="PartyMember" delimited="true"/>
        </chunked>
    </packet>

    <packet family="Party" action="Add">
        <comment>New player joined the party</comment>
        <field name="member" type="PartyMember"/>
    </packet>

    <packet family="Party" action="Remove">
        <comment>Player left the party</comment>
        <field name="player_id" type="short"/>
    </packet>

    <packet family="Party" action="Close">
        <comment>Left / disbanded a party</comment>
        <dummy type="byte">255</dummy>
    </packet>

    <packet family="Party" action="List">
        <comment>Party member list update</comment>
        <chunked>
            <array name="members" type="PartyMember" delimited="true"/>
        </chunked>
    </packet>

    <packet family="Party" action="Agree">
        <comment>Party member list update</comment>
        <field name="player_id" type="short"/>
        <field name="hp_percentage" type="char"/>
    </packet>

    <packet family="Party" action="TargetGroup">
        <comment>Updated experience and level-ups from party experience</comment>
        <array name="gains" type="PartyExpShare"/>
    </packet>

    <packet family="Guild" action="Reply">
        <comment>Generic guild reply messages</comment>
        <field name="reply_code" type="GuildReply"/>
        <switch field="reply_code">
            <case value="CreateAdd">
                <field name="name" type="string"/>
            </case>
            <case value="CreateAddConfirm">
                <field name="name" type="string"/>
            </case>
            <case value="JoinRequest">
                <field name="player_id" type="short"/>
                <field name="name" type="string"/>
            </case>
        </switch>
    </packet>

    <packet family="Guild" action="Request">
        <comment>Guild create request</comment>
        <field name="player_id" type="short"/>
        <field name="guild_identity" type="string"/>
    </packet>

    <packet family="Guild" action="Create">
        <comment>Guild created</comment>
        <chunked>
            <field name="leader_player_id" type="short"/>
            <break/>
            <field name="guild_tag" type="string"/>
            <break/>
            <field name="guild_name" type="string"/>
            <break/>
            <field name="rank_name" type="string"/>
            <break/>
            <field name="gold_amount" type="int"/>
        </chunked>
    </packet>

    <packet family="Guild" action="Take">
        <comment>Get guild description reply</comment>
        <field name="description" type="string"/>
    </packet>

    <packet family="Guild" action="Rank">
        <comment>Get guild rank list reply</comment>
        <chunked>
            <array name="ranks" type="string" length="9" delimited="true"/>
        </chunked>
    </packet>

    <packet family="Guild" action="Sell">
        <comment>Get guild bank reply</comment>
        <field name="gold_amount" type="int"/>
    </packet>

    <packet family="Guild" action="Buy">
        <comment>Deposit guild bank reply</comment>
        <field name="gold_amount" type="int"/>
    </packet>

    <packet family="Guild" action="Open">
        <comment>Talk to guild master NPC reply</comment>
        <field name="session_id" type="three"/>
    </packet>

    <packet family="Guild" action="Tell">
        <comment>Get guild member list reply</comment>
        <chunked>
            <length name="members_count" type="short"/>
            <break/>
            <array name="members" type="GuildMember" length="members_count" delimited="true"/>
        </chunked>
    </packet>

    <packet family="Guild" action="Report">
        <comment>Get guild info reply</comment>
        <chunked>
            <field name="name" type="string"/>
            <break/>
            <field name="tag" type="string"/>
            <break/>
            <field name="create_date" type="string"/>
            <break/>
            <field name="description" type="string"/>
            <break/>
            <field name="wealth" type="string"/>
            <break/>
            <array name="ranks" type="string" length="9" delimited="true"/>
            <length name="staff_count" type="short"/>
            <break/>
            <array name="staff" type="GuildStaff" length="staff_count" delimited="true"/>
        </chunked>
    </packet>

    <packet family="Guild" action="Agree">
        <comment>Joined guild info</comment>
        <chunked>
            <field name="recruiter_id" type="short"/>
            <break/>
            <field name="guild_tag" type="string"/>
            <break/>
            <field name="guild_name" type="string"/>
            <break/>
            <field name="rank_name" type="string"/>
            <break/>
        </chunked>
    </packet>

    <packet family="Guild" action="Accept">
        <comment>Update guild rank</comment>
        <field name="rank" type="char"/>
    </packet>

    <packet family="Guild" action="Kick">
        <comment>Left the guild</comment>
        <!--
            The official server never sends this packet, so the dummy byte is unknown.
            This packet is only known as a result of decompiling the official client.
        -->
        <dummy type="byte">255</dummy>
    </packet>

    <packet family="Spell" action="Request">
        <comment>Nearby player chanting a spell</comment>
        <field name="player_id" type="short"/>
        <field name="spell_id" type="short"/>
    </packet>

    <packet family="Spell" action="TargetSelf">
        <comment>Nearby player self-casted a spell</comment>
        <field name="player_id" type="short"/>
        <field name="spell_id" type="short"/>
        <field name="spell_heal_hp" type="int"/>
        <field name="hp_percentage" type="char"/>
        <field name="hp" type="short" optional="true">
            <comment>The official client reads this if the packet is larger than 12 bytes</comment>
        </field>
        <field name="tp" type="short" optional="true">
            <comment>The official client reads this if the packet is larger than 12 bytes</comment>
        </field>
    </packet>

    <packet family="Spell" action="Player">
        <comment>Nearby player raising their arm to cast a spell (vestigial)</comment>
        <field name="player_id" type="short"/>
        <field name="direction" type="Direction"/>
    </packet>

    <packet family="Spell" action="Error">
        <comment>Show flood protection message (vestigial)</comment>
        <dummy type="byte">255</dummy>
    </packet>

    <packet family="Avatar" action="Admin">
        <comment>Nearby player hit by a damage spell from a player</comment>
        <field name="caster_id" type="short"/>
        <field name="victim_id" type="short"/>
        <field name="damage" type="three"/>
        <field name="caster_direction" type="Direction"/>
        <field name="hp_percentage" type="char"/>
        <field name="victim_died" type="bool"/>
        <field name="spell_id" type="short"/>
    </packet>

    <packet family="Spell" action="TargetGroup">
        <comment>Nearby player(s) hit by a group heal spell from a player</comment>
        <field name="spell_id" type="short"/>
        <field name="caster_id" type="short"/>
        <field name="caster_tp" type="short"/>
        <field name="spell_heal_hp" type="short"/>
        <array name="players" type="GroupHealTargetPlayer"/>
    </packet>

    <packet family="Spell" action="TargetOther">
        <comment>Nearby player hit by a heal spell from a player</comment>
        <field name="victim_id" type="short"/>
        <field name="caster_id" type="short"/>
        <field name="caster_direction" type="Direction"/>
        <field name="spell_id" type="short"/>
        <field name="spell_heal_hp" type="int"/>
        <field name="hp_percentage" type="char"/>
        <field name="hp" type="short" optional="true"/>
    </packet>

    <packet family="Spell" action="Reply">
        <comment>Your character self-cast a targetable heal spell</comment>
        <!--
            The official client updates the casting character's SP by reading the spell's SP cost
            from the pub file.
        -->
        <field type="short" name="spell_id"/>
        <field type="short" name="hp"/>
        <field type="short" name="tp"/>
    </packet>

    <packet family="Trade" action="Request">
        <comment>Trade request from another player</comment>
        <!--
            Unlike the official server's handling of the client TRADE_REQUEST packet, the official
            client does not verify that this number is 138.
        -->
        <field type="char">138</field>
        <field name="partner_player_id" type="short"/>
        <field name="partner_player_name" type="string"/>
    </packet>

    <packet family="Trade" action="Open">
        <comment>Trade window opens</comment>
        <chunked>
            <field name="partner_player_id" type="short"/>
            <field name="partner_player_name" type="string"/>
            <break/>
            <field name="your_player_id" type="short"/>
            <field name="your_player_name" type="string"/>
            <break/>
        </chunked>
    </packet>

    <packet family="Trade" action="Reply">
        <comment>Trade updated (items changed)</comment>
        <field name="trade_data" type="TradeItemData"/>
    </packet>

    <packet family="Trade" action="Admin">
        <comment>Trade updated (items changed while trade was accepted)</comment>
        <field name="trade_data" type="TradeItemData"/>
    </packet>

    <packet family="Trade" action="Use">
        <comment>Trade completed</comment>
        <field name="trade_data" type="TradeItemData"/>
    </packet>

    <packet family="Trade" action="Spec">
        <comment>Own agree state updated</comment>
        <field name="agree" type="bool"/>
    </packet>

    <packet family="Trade" action="Agree">
        <comment>Partner agree state updated</comment>
        <field name="partner_player_id" type="short"/>
        <field name="agree" type="bool"/>
    </packet>

    <packet family="Trade" action="Close">
        <comment>Partner closed trade window</comment>
        <field name="partner_player_id" type="short"/>
    </packet>

    <packet family="Npc" action="Reply">
        <comment>Nearby NPC hit by a player</comment>
        <field name="player_id" type="short"/>
        <field name="player_direction" type="Direction"/>
        <field name="npc_index" type="short"/>
        <field name="damage" type="three"/>
        <field name="hp_percentage" type="short"/>
        <field name="kill_steal_protection" type="NpcKillStealProtectionState" optional="true">
            <comment>This field should be sent to the attacker, but not nearby players</comment>
        </field>
    </packet>

    <packet family="Cast" action="Reply">
        <comment>Nearby NPC hit by a spell from a player</comment>
        <field name="spell_id" type="short"/>
        <field name="caster_id" type="short"/>
        <field name="caster_direction" type="Direction"/>
        <field name="npc_index" type="short"/>
        <field name="damage" type="three"/>
        <field name="hp_percentage" type="short"/>
        <field name="caster_tp" type="short" optional="true">
            <comment>This field should be sent to the attacker, but not nearby players</comment>
        </field>
        <field name="kill_steal_protection" type="NpcKillStealProtectionState" optional="true">
            <comment>This field should be sent to the attacker, but not nearby players</comment>
        </field>
    </packet>

    <packet family="Npc" action="Spec">
        <comment>Nearby NPC killed by player</comment>
        <field name="npc_killed_data" type="NpcKilledData"/>
        <field name="experience" type="int" optional="true">
            <comment>This field should be sent to the killer, but not nearby players</comment>
        </field>
    </packet>

    <packet family="Npc" action="Accept">
        <comment>Nearby NPC killed and killer leveled up</comment>
        <field name="npc_killed_data" type="NpcKilledData"/>
        <field name="experience" type="int" optional="true">
            <comment>This field should be sent to the killer, but not nearby players</comment>
        </field>
        <field name="level_up" type="LevelUpStats" optional="true">
            <comment>This field should be sent to the killer if they leveled up, but not nearby players</comment>
        </field>
    </packet>

    <packet family="Cast" action="Spec">
        <comment>Nearby NPC killed by player spell</comment>
        <field name="spell_id" type="short"/>
        <field name="npc_killed_data" type="NpcKilledData"/>
        <field name="caster_tp" type="short" optional="true">
            <comment>This field should be sent to the killer, but not nearby players</comment>
        </field>
        <field name="experience" type="int" optional="true">
            <comment>This field should be sent to the killer, but not nearby players</comment>
        </field>
    </packet>

    <packet family="Cast" action="Accept">
        <comment>Nearby NPC killed by player spell and killer leveled up</comment>
        <field name="spell_id" type="short"/>
        <field name="npc_killed_data" type="NpcKilledData"/>
        <field name="caster_tp" type="short" optional="true">
            <comment>This field should be sent to the killer, but not nearby players</comment>
        </field>
        <field name="experience" type="int" optional="true">
            <comment>This field should be sent to the killer, but not nearby players</comment>
        </field>
        <field name="level_up" type="LevelUpStats" optional="true">
            <comment>This field should be sent to the killer if they leveled up, but not nearby players</comment>
        </field>
    </packet>

    <packet family="Npc" action="Junk">
        <comment>Clearing all boss children</comment>
        <field name="npc_id" type="short"/>
    </packet>

    <packet family="Npc" action="Player">
        <comment>Main NPC update message</comment>
        <chunked>
            <array name="positions" type="NpcUpdatePosition"/>
            <break/>
            <array name="attacks" type="NpcUpdateAttack"/>
            <break/>
            <array name="chats" type="NpcUpdateChat"/>
            <break/>
            <field name="hp" type="short" optional="true"/>
            <field name="tp" type="short" optional="true"/>
        </chunked>
    </packet>

    <packet family="Npc" action="Dialog">
        <comment>NPC chat message</comment>
        <field name="npc_index" type="short"/>
        <field name="message" type="string"/>
    </packet>

    <packet family="Quest" action="Report">
        <comment>NPC chat messages</comment>
        <chunked>
            <field name="npc_id" type="short"/>
            <break/>
            <array name="messages" type="string" delimited="true"/>
        </chunked>
    </packet>

    <packet family="Quest" action="Dialog">
        <comment>Quest selection dialog</comment>
        <chunked>
            <length name="quest_count" type="char"/>
            <field name="behavior_id" type="short"/>
            <field name="quest_id" type="short"/>
            <field name="session_id" type="short"/>
            <field name="dialog_id" type="short"/>
            <break/>
            <array name="quest_entries" type="DialogQuestEntry" length="quest_count" delimited="true"/>
            <array name="dialog_entries" type="DialogEntry" delimited="true"/>
        </chunked>
    </packet>

    <packet family="Quest" action="List">
        <comment>Quest history / progress reply</comment>
        <chunked>
            <field name="page" type="QuestPage"/>
            <field name="quests_count" type="short"/>
            <switch field="page">
                <case value="Progress">
                    <array name="quest_progress_entries" type="QuestProgressEntry" delimited="true"/>
                </case>
                <case value="History">
                    <array name="completed_quests" type="string" delimited="true"/>
                </case>
            </switch>
        </chunked>
    </packet>

    <packet family="Item" action="Accept">
        <comment>Nearby player leveled up from quest</comment>
        <field name="player_id" type="short"/>
    </packet>

    <packet family="Arena" action="Drop">
        <comment>"Arena is blocked" message</comment>
        <dummy type="string">N</dummy>
    </packet>

    <packet family="Arena" action="Use">
        <comment>Arena start message</comment>
        <field name="players_count" type="char"/>
    </packet>

    <packet family="Arena" action="Spec">
        <comment>Arena kill message</comment>
        <chunked>
            <field name="player_id" type="short"/>
            <break/>
            <field name="direction" type="Direction"/>
            <break/>
            <field name="kills_count" type="int"/>
            <break/>
            <field name="killer_name" type="string"/>
            <break/>
            <field name="victim_name" type="string"/>
        </chunked>
    </packet>

    <packet family="Arena" action="Accept">
        <comment>Arena win message</comment>
        <chunked>
            <field name="winner_name" type="string"/>
            <break/>
            <field name="kills_count" type="int"/>
            <break/>
            <field name="killer_name" type="string"/>
            <break/>
            <field name="victim_name" type="string"/>
        </chunked>
    </packet>

    <packet family="Marriage" action="Open">
        <comment>Response from talking to a law NPC</comment>
        <field name="session_id" type="three"/>
    </packet>

    <packet family="Marriage" action="Reply">
        <comment>Reply to client Marriage-family packets</comment>
        <field name="reply_code" type="MarriageReply"/>
        <switch field="reply_code">
            <case value="Success">
                <field name="gold_amount" type="int"/>
            </case>
        </switch>
    </packet>

    <packet family="Priest" action="Open">
        <comment>Response from talking to a priest NPC</comment>
        <field name="session_id" type="int"/>
    </packet>

    <packet family="Priest" action="Reply">
        <comment>Reply to client Priest-family packets</comment>
        <field name="reply_code" type="PriestReply"/>
    </packet>

    <packet family="Priest" action="Request">
        <comment>Wedding request</comment>
        <field name="session_id" type="short"/>
        <field name="partner_name" type="string"/>
    </packet>

    <packet family="Recover" action="Player">
        <comment>HP/TP update</comment>
        <field name="hp" type="short"/>
        <field name="tp" type="short"/>
        <field type="short">0</field>
    </packet>

    <packet family="Recover" action="Agree">
        <comment>Nearby player gained HP</comment>
        <field name="player_id" type="short"/>
        <field name="heal_hp" type="int"/>
        <field name="hp_percentage" type="char"/>
    </packet>

    <packet family="Recover" action="List">
        <comment>Stats update</comment>
        <field name="class_id" type="short"/>
        <field name="stats" type="CharacterStatsUpdate"/>
    </packet>

    <packet family="Recover" action="Reply">
        <comment>Karma/experience update</comment>
        <field name="experience" type="int"/>
        <field name="karma" type="short"/>
        <field name="level_up" type="char" optional="true">
            <comment>
                A value greater than 0 is "new level" and indicates the player leveled up.
                The official client reads this if the packet is larger than 6 bytes.
            </comment>
        </field>
        <field name="stat_points" type="short" optional="true">
            <comment>The official client reads this if the player leveled up</comment>
        </field>
        <field name="skill_points" type="short" optional="true">
            <comment>The official client reads this if the player leveled up</comment>
        </field>
    </packet>

    <packet family="Recover" action="TargetGroup">
        <comment>Updated stats when levelling up from party experience</comment>
        <field name="stat_points" type="short"/>
        <field name="skill_points" type="short"/>
        <field name="max_hp" type="short"/>
        <field name="max_tp" type="short"/>
        <field name="max_sp" type="short"/>
    </packet>

    <packet family="Effect" action="Use">
        <comment>Map effect</comment>
        <field name="effect" type="MapEffect"/>
        <switch field="effect">
            <case value="Quake">
                <field name="quake_strength" type="char"/>
            </case>
        </switch>
    </packet>

    <packet family="Effect" action="Agree">
        <comment>Effects playing on nearby tiles</comment>
        <array name="effects" type="TileEffect"/>
    </packet>

    <packet family="Effect" action="TargetOther">
        <comment>Map drain damage</comment>
        <field name="damage" type="short"/>
        <field name="hp" type="short"/>
        <field name="max_hp" type="short"/>
        <array name="others" type="MapDrainDamageOther"/>
    </packet>

    <packet family="Effect" action="Report">
        <comment>Map spike timer</comment>
        <dummy type="string">S</dummy>
    </packet>

    <packet family="Effect" action="Spec">
        <comment>Taking spike or tp drain damage</comment>
        <field name="map_damage_type" type="MapDamageType"/>
        <switch field="map_damage_type">
            <case value="TpDrain">
                <field name="tp_damage" type="short"/>
                <field name="tp" type="short"/>
                <field name="max_tp" type="short"/>
            </case>
            <case value="Spikes">
                <field name="hp_damage" type="short"/>
                <field name="hp" type="short"/>
                <field name="max_hp" type="short"/>
            </case>
        </switch>
    </packet>

    <packet family="Effect" action="Admin">
        <comment>Nearby character taking spike damage</comment>
        <field name="player_id" type="short"/>
        <field name="hp_percentage" type="char"/>
        <field name="died" type="bool"/>
        <field name="damage" type="three"/>
    </packet>

    <packet family="Music" action="Player">
        <comment>Sound effect</comment>
        <field name="sound_id" type="char"/>
    </packet>
</protocol>